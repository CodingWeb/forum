<?php

// Remplacer les accents !
function replace_accents($str)
{
    $str = htmlentities($str, ENT_COMPAT, "UTF-8");
    $str = preg_replace('/&([a-zA-Z])(uml|acute|grave|circ|tilde);/', '$1', $str);
    return html_entity_decode($str);
}

// Pour avoir une url propre !
function url_title($str)
{
    $str = str_replace(' ', '-', $str);
    return strtolower($str);
}

// vérifier si le pseudo n'ai pas deja pris

function check_pseudo($pseudo)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT id FROM membres WHERE pseudo=:pseudo');
    $requete->bindValue(':pseudo', $pseudo, PDO::PARAM_STR);
    $requete->execute();
    if ($requete->rowCount() == $pseudo) {
        return true;
    }
    $requete->closeCursor();
}

// vérifie si le champ email est deja pris
function check_emails($emails)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT id FROM membres WHERE email=:emails');
    $requete->bindValue(':emails', $emails, PDO::PARAM_STR);
    $requete->execute();
    if ($requete->rowCount() == $emails) {
        return true;
    }
    $requete->closeCursor();
}


// Ajouter un membre dans la basse de donnée

function add_membre($pseudo, $emails, $pass)
{
    require 'connect.php';
    $requete = $bdd->prepare('INSERT INTO membres (pseudo, email, pass) VALUES (:pseudo,:email,:pass)');
    $requete->bindValue(':pseudo', $pseudo, PDO::PARAM_STR);
    $requete->bindValue(':email', $emails, PDO::PARAM_STR);
    $requete->bindValue(':pass', sha1($pass), PDO::PARAM_STR);
    $requete->execute();
    $requete->closeCursor();
}

// Ajouter un formulaire de connexion

function check_id($pseudo, $pass)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT id FROM membres WHERE pseudo=:pseudo AND pass=:pass');
    $requete->bindValue(':pseudo', $pseudo, PDO::PARAM_STR);
    $requete->bindValue(':pass', sha1($pass), PDO::PARAM_STR);
    $requete->execute();
    if ($requete->rowCount() > 0) {
        return true;
    }
    $requete->closeCursor();
}

// les sessions, Si le membre est connecter ou pas

function check_session()
{
    if (!empty($_SESSION['membre'])) {
        return true;
    }
}


// Récupérer sont mot de pass via l'email

function get_pseudo($emails)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT pseudo FROM membres WHERE email=:email');
    $requete->bindValue(':email', $emails, PDO::PARAM_STR);
    $requete->execute();
    $data = $requete->fetchObject();
    $pseudo = $data->pseudo;
    return $pseudo;
}

// Modifie le mot de passe via l'email
function modif_pass($emails, $pass)
{
    require 'connect.php';
    $requete = $bdd->prepare('UPDATE membres SET pass=:pass WHERE email=:email');
    $requete->bindValue(':pass', sha1($pass), PDO::PARAM_STR);
    $requete->bindValue(':email', $emails, PDO::PARAM_STR);
    $requete->execute();
    $requete->closeCursor();
}

// Changer sont mot de pass via email

function get_email($pseudo)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT email FROM membres WHERE pseudo=:pseudo');
    $requete->bindValue(':pseudo', $pseudo, PDO::PARAM_STR);
    $requete->execute();
    $data = $requete->fetchObject();
    $emails = $data->email;
    return $emails;
    $requete->closeCursor();
}

// id du membre relier au topic
function get_membre_id($pseudo)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT id FROM membres WHERE pseudo=:pseudo');
    $requete->bindValue(':pseudo', $pseudo, PDO::PARAM_STR);
    $requete->execute();
    $data = $requete->fetchObject();
    $membre_id = $data->id;
    return $membre_id;
    $requete->closeCursor();
}

// ajouter le topic a la basse de donnée
function add_topic($titres, $message, $membre_id)
{
    require 'connect.php';
    $requete = $bdd->prepare('INSERT INTO topics (titre, message, membre_id) VALUES (:titre,:message,:membre_id)');
    $requete->bindValue(':titre', $titres, PDO::PARAM_STR);
    $requete->bindValue(':message', $message, PDO::PARAM_STR);
    $requete->bindValue(':membre_id', $membre_id, PDO::PARAM_INT);
    $requete->execute();
    $requete->closeCursor();
}

// Rechercher tout les topics

function get_topics()
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT * FROM topics ORDER BY id DESC');
    $requete->execute();
    $data = $requete->fetchAll();
    return $data;
    $requete->closeCursor();
}

// prend l'id du membre
function get_topic($id)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT * FROM topics WHERE id=:id');
    $requete->bindValue(':id', $id, PDO::PARAM_INT);
    $requete->execute();
    $data = $requete->fetchObject();
    return $data;
    $requete->closeCursor();
}
// prend l'id du membre_id pour les topic
function get_auteur_topic($membre_id)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT * FROM membres WHERE id=:membre_id');
    $requete->bindValue(':membre_id', $membre_id, PDO::PARAM_INT);
    $requete->execute();
    $data = $requete->fetchAll();
    return $data;
    $requete->closeCursor();
}
// récupère les info personnelle du membre
function membre_pseudo($pseudo)
{
    require 'connect.php';
    $requete = $bdd->prepare('SELECT * FROM membres WHERE pseudo=:pseudo');
    $requete->bindValue(':pseudo', $pseudo, PDO::PARAM_INT);
    $requete->execute();
    $data = $requete->fetchObject();
    return $data;
    $requete->closeCursor();
}
